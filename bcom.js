// ============================================================================
// comjs
// ============================================================================
// Name      : comjs
// Version   : 0.0.5
// Build date: 09-11-2014
// 
// Copyright (c) 2014, Stelios Anagnostopoulos <stelios@outlook.com>
// All rights reserved.
// ============================================================================
"use strict";window.com=window.bcom=function(){function a(a,b){var e,f,g;"string"==typeof a?(e=a,g=[],f=!1):(e=a.path,f=a.wss,g=a.auth||[]),arguments.length<3&&"function"==typeof f&&(b=f,f=!1);var e=(f?"wss://":"ws://")+e.match(/\/\/(.*)/)[1];D&&u.close(),w={},u=new WebSocket(e),u.onopen=function(){D=!0,c("root","auth",g,function(a){d(a),b()})},u.onclose=function(){D=!1},u.onmessage=function(a){if(a.data.length){var b=z(a.data),c=b[0],d=b[1],e=b[2];w[d]&&w[d].apply({done:1===e},c),e&&delete w[d]}}}function b(){if(D)if(u.bufferredAmount)var a=setInterval(function(){clearInterval(a),u.close()},100);else u.close()}function c(a,b,c,d){D||connect();var e=performance.now(),f=y([a,b,c,e]);w[e]=d,u.send(f)}function d(a){v={};var b,d;for(b in a){v[b]||(v[b]={});for(d in a[b])v[b][d]=function(a,b){return function(){var d=x.call(arguments),e="function"==typeof d[d.length-1]?d.pop():null;c(a,b,d,e)}}(b,d)}}function e(a,b,c,d,e){"string"==typeof b&&(e=d,d=c,c=b),"function"==typeof d&&(e=d,d=null);var f=new XMLHttpRequest;if(f.open(c,a,!0),f.onload=function(){if(4!==f.readyState||200!==f.status&&201!==f.status){if(1===C(f.status/4))throw new Error("Request failed with "+f.status)}else{var a=f.responseText;if(a){if("object"==typeof a)return e(a);try{a=z(f.responseText)}catch(b){}}e(a)}},f.onerror=function(){throw new Error("request failed with "+f.status)},d)for(var g in d)f.setRequestHeader(g,d[g]);("POST"===c||"PUT"===c)&&(f.setRequestHeader("Content-Type","application/json"),"object"==typeof b&&(b=y(b))),f.send(b)}function f(a,b,c){e(a,"GET",b,c)}function g(a,b,c,d){e(a,b,"PUT",c,d)}function h(a,b,c,d){e(a,b,"POST",c,d)}function i(a,b,c){e(a,"GET",b,c)}function j(a,b,c){var d=a;d.match(/.js$/)||(d+=".js"),d.match(/^.\//)||(d=d.match(/^\//)?"."+d:"./"+d),E[d]={module:3===arguments.length?c:b,dependencies:3===arguments.length?m(b).js:[],status:0}}function k(a,b){var c=m(a);t([[c.css,n],[c.html,o],[c.text,o]],function(){s(c.js,function(a,b){if(E[a])if(0===E[a].status)if("function"==typeof E[a].module)if(E[a].dependencies)s(E[a].dependencies,k,function(c){delete E[a].dependencies;var d={};E[a].module=E[a].module.apply(d,c),E[a].module||(E[a].module=d),E[a].status=1,b(E[a].module)});else{var c={};E[a].module=E[a].module.call(c),E[a].module||(E[a].module=c),E[a].status=1,b(E[a].module)}else E[a].status=1,b(E[a].module);else 1===E[a].status&&b(E[a].module);else p(a,function(){k(a,b)})},function(a){b.apply(null,a)})})}function l(a,b){var c=m(a);t([[c.css,function(a,b){"object"==typeof a?n(a[0],a[1],b):n(a,b)}],[c.html,function(a,b){"object"==typeof a?o(a[0],a[1],b):o(a,b)}],[c.js,function(a,b){"object"==typeof a?p(a[0],a[1],b):p(a,b)}],[c.text,function(a,b){"object"==typeof a?o(a[0],a[1],b):o(a,b)}]],function(){b()})}function m(a){for(var b,a=a instanceof Array?a:[a],c=0,d=[],e=[],f=[],g=[];c<a.length;){switch(b=a[c].match(/.*\.(.*)/),b&&"/"!==b[b.length-1][0]?b=b[b.length-1]:(b="js",a[c]+=".js"),a[c].match(/^.\//)||(a[c]=a[c].match(/^\//)?"."+a[c]:"./"+a[c]),b){case"js":d[d.length]=a[c];break;case"css":e[e.length]=a[c];break;case"html":f[f.length]=a[c];break;default:g[g.length]=a[c]}c++}return{js:d,html:f,css:e,text:g}}function n(a,b,c){c=arguments[arguments.length-1],"function"==typeof b&&(c=b,b=document.body),b||(b=document.body),a.match(/.css$/)||(a+=".css");var d=document.createElement("link");d.href=a,d.rel="stylesheet",d.type="text/css",d.onload=c,d.onerror=function(a){throw new URIError("the stylesheet "+a.target.src+" is not accessible")},b.appendChild(d)}function o(a,b,c){c=arguments[arguments.length-1],"function"==typeof b&&(c=b,b=document.body),b||(b=document.body),a.match(/.html$/)||(a+=".html");var d=new XMLHttpRequest;d.open("GET",a,!0),d.onload=function(){if(4!==d.readyState||200!==d.status)throw new Error("http failed with status: "+d.status+", reason: "+d.statusText);b.insertAdjacentHTML("beforeend",d.responseText),c()},d.send()}function p(a,b,c){c=arguments[arguments.length-1],"function"==typeof b&&(c=b,b=document.body),b||(b=document.body),a.match(/.js$/)||(a+=".js");var d=document.createElement("script");d.type="text/javascript",d.src=a,d.async=!0,d.onload=c,d.onerror=function(a){throw new URIError("the script "+a.target.src+" is not accessible")},b.appendChild(d)}function q(a,b){b instanceof Array||(b=[b]);for(var c=new Array(b.length),d=0,e=b.length;e>d;d++)r(a.prototype,b[d]),c[d]=B(b[d]);var f=function(){if(a.prototype._preInit)for(var b=0,d=a.prototype._preInit.length;d>b;b++)a.prototype._preInit[b].apply(this,arguments);if(a.apply(this,arguments),a.prototype._postInit)for(var b=0,d=a.prototype._postInit.length;d>b;b++)a.prototype._postInit[b].apply(this,arguments);for(var e,f,g=c.length;g--;)for(e=c[g],f=e.length;f--;)if("string"==typeof this[e[f]]&&0===this[e[f]].indexOf("@require"))throw new Error("missing contract member: "+e[f])};return f.prototype=new a,f.prototype.constructor=f,f}function r(a,b){var c,d={},e=[];for(var f in b)"string"==typeof b[f]&&"@require"!==b[f]?d[f]=function(a){return{configurable:!0,get:function(){for(var b=this[a[0]],c=1,d=a.length;d>c;c++)b=b[a[c]];return b},set:function(b){for(var c=this[a[0]],d=1,e=a.length-1;e>d;d++)c=c[a[d]];c[a[a.length-1]]=b}}}(b[f].split(".")):"object"==typeof b[f]?d[f]=b[f]:"function"==typeof b[f]&&("preInit"===f||"postInit"===f?(c="_"+f,a[c]||(a[c]=[]),a[c][a[c].length]=b[f]):e[e.length]=[f,b[f]]);A(a,d);for(var f,g,h,i=0,j=e.length;j>i;i++)f=e[i][0],g=e[i][1],a[f]&&(h=a[f]),a[f]=g,a[f].super=h}function s(a,b,c){a instanceof Array||(a=[a]);var d=0,e=a.length,f=[];if(!e)return c([]);var g=function(){b(a[d++],function(a){f[f.length]=a,d>=e?c(f):g()})};g()}function t(a,b){a instanceof Array||(a=[].concat(a)),s(a,function(a,b){s(a[0],a[1],b)},b)}var u,v,w,x=Array.prototype.slice,y=JSON.stringify,z=JSON.parse,A=(Object.defineProperty,Object.defineProperties),B=Object.keys,C=Math.floor,D=!1,E={};return{get proxy(){return v},open:a,close:b,submitGet:f,submitPut:g,submitPost:h,submitDelete:i,declare:j,invoke:k,append:l,define:q}}();