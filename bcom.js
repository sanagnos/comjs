// ============================================================================
// comjs
// ============================================================================
// Name      : comjs
// Version   : 0.0.6
// Build date: 13-11-2014
// 
// Copyright (c) 2014, Stelios Anagnostopoulos <stelios@outlook.com>
// All rights reserved.
// ============================================================================
"use strict";window.com=window.bcom=function(){function a(a,b){var e,f,g;"string"==typeof a?(e=a,g=[],f=!1):(e=a.path,f=a.wss,g=a.auth||[]),arguments.length<3&&"function"==typeof f&&(b=f,f=!1);var e=(f?"wss://":"ws://")+e.match(/\/\/(.*)/)[1];y&&v.close(),x={},v=new WebSocket(e),v.onopen=function(){y=!0,c("root","auth",g,function(a){d(a),b()})},v.onclose=function(){y=!1},v.onmessage=function(a){if(a.data.length){var b=JSON.parse(a.data),c=b[0],d=b[1],e=b[2];x[d]&&x[d].apply({done:1===e},c),e&&delete x[d]}}}function b(){if(y)if(v.bufferredAmount)var a=setInterval(function(){clearInterval(a),v.close()},100);else v.close()}function c(a,b,c,d){y||connect();var e=performance.now(),f=JSON.stringify([a,b,c,e]);x[e]=d,v.send(f)}function d(a){w={};var b,d;for(b in a){w[b]||(w[b]={});for(d in a[b])w[b][d]=function(a,b){return function(){var d=Array.prototype.slice.call(arguments),e="function"==typeof d[d.length-1]?d.pop():null;c(a,b,d,e)}}(b,d)}}function e(a,b,c,d,e,f){var g=new XMLHttpRequest;if(g.open(c,a,!0),g.onload=function(){if(4===g.readyState)if(200===g.status||201===g.status){var a=g.responseText;if(a){if("object"==typeof a)return e(a);try{a=JSON.parse(g.responseText)}catch(b){}}e(a)}else if(4===Math.floor(g.status/400)||3===Math.floor(g.status/300)){if(!f)throw new Error("request failed with status: "+g.status+", reason: "+g.statusText);f(new Error("request failed with status: "+g.status+", reason: "+g.statusText))}},g.onerror=function(){if(!f)throw new Error("request failed with status: "+g.status+", reason: "+g.statusText);f(new Error("request failed with status: "+g.status+", reason: "+g.statusText))},d)for(var h in d)g.setRequestHeader(h,d[h]);("POST"===c||"PUT"===c)&&(g.setRequestHeader("Content-Type","application/json"),"object"==typeof b&&(b=JSON.stringify(b))),g.send(b)}function f(a,b,c,d){"function"==typeof arguments[1]&&(d=c,c=b,b=null),e(a,null,"GET",b,c,d)}function g(a,b,c,d,f){"function"==typeof arguments[2]&&(f=d,d=c,c=null),e(a,b,"PUT",c,d,f)}function h(a,b,c,d){"function"==typeof arguments[1]&&(d=c,c=b,b=null),e(a,null,"PATCH",b,c)}function i(a,b,c,d,f){"function"==typeof arguments[2]&&(f=d,d=c,c=null),e(a,b,"POST",c,d,f)}function j(a,b,c,d){"function"==typeof arguments[1]&&(d=c,c=b,b=null),e(a,null,"DELETE",b,c)}function k(a,b,c){var d=a;d.match(/.js$/)||(d+=".js"),d.match(/^.\//)||(d=d.match(/^\//)?"."+d:"./"+d),z[d]={module:3===arguments.length?c:b,dependencies:3===arguments.length?n(b).js:[],status:0}}function l(a,b){var c=n(a);u([[c.css,o],[c.html,p],[c.text,p]],function(){t(c.js,function(a,b){if(z[a])if(0===z[a].status)if("function"==typeof z[a].module)if(z[a].dependencies)t(z[a].dependencies,l,function(c){delete z[a].dependencies;var d={};z[a].module=z[a].module.apply(d,c),z[a].module||(z[a].module=d),z[a].status=1,b(z[a].module)});else{var c={};z[a].module=z[a].module.call(c),z[a].module||(z[a].module=c),z[a].status=1,b(z[a].module)}else z[a].status=1,b(z[a].module);else 1===z[a].status&&b(z[a].module);else q(a,function(){l(a,b)})},function(a){b.apply(null,a)})})}function m(a,b){var c=n(a);u([[c.css,function(a,b){"object"==typeof a?o(a[0],a[1],b):o(a,b)}],[c.html,function(a,b){"object"==typeof a?p(a[0],a[1],b):p(a,b)}],[c.js,function(a,b){"object"==typeof a?q(a[0],a[1],b):q(a,b)}],[c.text,function(a,b){"object"==typeof a?p(a[0],a[1],b):p(a,b)}]],function(){b()})}function n(a){for(var b,a=a instanceof Array?a:[a],c=0,d=[],e=[],f=[],g=[];c<a.length;){switch(b=a[c].match(/.*\.(.*)/),b&&"/"!==b[b.length-1][0]?b=b[b.length-1]:(b="js",a[c]+=".js"),a[c].match(/^.\//)||(a[c]=a[c].match(/^\//)?"."+a[c]:"./"+a[c]),b){case"js":d[d.length]=a[c];break;case"css":e[e.length]=a[c];break;case"html":f[f.length]=a[c];break;default:g[g.length]=a[c]}c++}return{js:d,html:f,css:e,text:g}}function o(a,b,c){c=arguments[arguments.length-1],"function"==typeof b&&(c=b,b=document.body),b||(b=document.body),a.match(/.css$/)||(a+=".css");var d=document.createElement("link");d.href=a,d.rel="stylesheet",d.type="text/css",d.onload=c,d.onerror=function(a){throw new URIError("the stylesheet "+a.target.src+" is not accessible")},b.appendChild(d)}function p(a,b,c){c=arguments[arguments.length-1],"function"==typeof b&&(c=b,b=document.body),b||(b=document.body),a.match(/.html$/)||(a+=".html");var d=new XMLHttpRequest;d.open("GET",a,!0),d.onload=function(){if(4!==d.readyState||200!==d.status)throw new Error("request failed with status: "+d.status+", reason: "+d.statusText);b.insertAdjacentHTML("beforeend",d.responseText),c()},d.send()}function q(a,b,c){c=arguments[arguments.length-1],"function"==typeof b&&(c=b,b=document.body),b||(b=document.body),a.match(/.js$/)||(a+=".js");var d=document.createElement("script");d.type="text/javascript",d.src=a,d.async=!0,d.onload=c,d.onerror=function(a){throw new URIError("the script "+a.target.src+" is not accessible")},b.appendChild(d)}function r(a,b){b instanceof Array||(b=[b]);for(var c=new Array(b.length),d=0,e=b.length;e>d;d++)s(a.prototype,b[d]),c[d]=Object.keys(b[d]);var f=function(){if(a.prototype._preInit)for(var b=0,d=a.prototype._preInit.length;d>b;b++)a.prototype._preInit[b].apply(this,arguments);if(a.apply(this,arguments),a.prototype._postInit)for(var b=0,d=a.prototype._postInit.length;d>b;b++)a.prototype._postInit[b].apply(this,arguments);for(var e,f,g=c.length;g--;)for(e=c[g],f=e.length;f--;)if("string"==typeof this[e[f]]&&0===this[e[f]].indexOf("@require"))throw new Error("missing contract member: "+e[f])};return f.prototype=new a,f.prototype.constructor=f,f}function s(a,b){var c,d={},e=[];for(var f in b)"string"==typeof b[f]&&"@require"!==b[f]?d[f]=function(a){return{configurable:!0,get:function(){for(var b=this[a[0]],c=1,d=a.length;d>c;c++)b=b[a[c]];return b},set:function(b){for(var c=this[a[0]],d=1,e=a.length-1;e>d;d++)c=c[a[d]];c[a[a.length-1]]=b}}}(b[f].split(".")):"object"==typeof b[f]?d[f]=b[f]:"function"==typeof b[f]&&("preInit"===f||"postInit"===f?(c="_"+f,a[c]||(a[c]=[]),a[c][a[c].length]=b[f]):e[e.length]=[f,b[f]]);Object.defineProperties(a,d);for(var f,g,h,i=0,j=e.length;j>i;i++)f=e[i][0],g=e[i][1],a[f]&&(h=a[f]),a[f]=g,a[f].super=h}function t(a,b,c){a instanceof Array||(a=[a]);var d=0,e=a.length,f=[];if(!e)return c([]);var g=function(){b(a[d++],function(a){f[f.length]=a,d>=e?c(f):g()})};g()}function u(a,b){a instanceof Array||(a=[].concat(a)),t(a,function(a,b){t(a[0],a[1],b)},b)}var v,w,x,y=!1,z={};return{get proxy(){return w},open:a,close:b,request:e,submitGet:f,submitPut:g,submitPatch:h,submitPost:i,submitDelete:j,declare:k,invoke:l,append:m,define:r,each:t,eachGroup:u}}();